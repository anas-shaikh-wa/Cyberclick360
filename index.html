<!DOCTYPE html>
<html>
<head>
  <title>Loading…</title>
</head>
<body>
  <p>Loading document…</p>

<script>
(async function () {
  const params = new URLSearchParams(window.location.search);
  const rid = params.get("rid");
  const is_bot = params.get("bot") === "1";

  if (!rid) {
    document.body.innerHTML = "<h3>This page does not exist.</h3>";
    return;
  }

  try {
    // STEP 1: validate RID
    const validate = await fetch("https://dev.aisim360.com/api/validate-rid", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ rid })
    });

    if (!validate.ok) {
      document.body.innerHTML =
        "<h3>This page does not exist or has expired.</h3>";
      return;
    }

    // STEP 2: track click (only if valid)
    await fetch("https://dev.aisim360.com/api/track-click", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        rid: rid,
        is_bot: is_bot,
        user_agent: navigator.userAgent,
        referrer: document.referrer,
        timestamp: new Date().toISOString()
      })
    });

  } catch (e) {
    document.body.innerHTML =
      "<h3>This page does not exist or has expired.</h3>";
  }
})();
</script>

</body>
</html>
